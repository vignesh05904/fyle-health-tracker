<!-- NavBar Start -->
<nav class="flex justify-between items-center p-5 bg-gray-300">
  <div class="flex justify-center">
    <img src="https://pbs.twimg.com/profile_images/937963393247461377/caTNUqSb_400x400.jpg" class="h-8 rounded-lg mr-2">
    <h2 class="text-2xl font-custom text-gray-700 cursor-default"> Health Challenge Tracker </h2>
  </div>

  <div class="flex justify-center">
    <div class="hidden md:flex space-x-6">
      <a href="#" class="font-light font-normal cursor-default">{{CurrentDateTime}}</a>
    </div>
  </div>
</nav> 
<!-- NavBar End -->



<!-- Add Workout Component -->
<app-add-workout></app-add-workout>



<!-- Workout Table Display Start -->
<div class="grid grid-cols-1 px-5 md:px-20">
  <div class="flex flex-col md:flex-row justify-between pb-5 gap-3">
    <input [(ngModel)]="searchName" (input)="filterByNameType()" class="w-full md:w-1/3 px-4 py-2 rounded-lg bg-custom-table-body text-white placeholder-white focus:outline-none" placeholder="Search by name"/>

    <select [(ngModel)]="workoutType" (change)="filterByType(workoutType)" id="workoutType" class="px-4 py-2 rounded-lg bg-primary-light text-white focus:outline-none">
      <option value="">All</option>
      <option value="Running">Running</option>
      <option value="Swimming">Swimming</option>
      <option value="Cycling">Cycling</option>
    </select>
  </div>

  <div class="rounded-lg font-custom shadow-2xl overflow-x-auto">
    <table class="min-w-full text-white shadow-lg rounded-lg overflow-hidden">
      <thead class="bg-custom-table-header rounded-lg shadow-lg">
        <tr class="rounded-lg">
          <th class="px-6 py-3 text-left whitespace-nowrap">Name</th>
          <th class="px-6 py-3 text-left whitespace-nowrap">Workouts</th>
          <th class="px-6 py-3 text-center whitespace-nowrap">Number of Workouts</th>
          <th class="px-6 py-3 text-center whitespace-nowrap">Total Workout Minutes</th>
        </tr>
      </thead>
      <tbody class="bg-custom-table-body">
        <tr *ngFor="let user of paginatedUsers" class="border-b border-purple-900">
          <td class="px-6 py-4">{{ user.name }}</td>
          <td class="px-6 py-4">
            <span *ngFor="let workout of user.workouts; let i = index">
              {{ workout.type }}<span *ngIf="i < user.workouts.length - 1">, </span>
            </span>
          </td>
          <td class="px-6 py-4 font-light text-center">{{ getWorkoutCount(user.workouts) }}</td>
          <td class="px-6 py-4 font-light text-center">{{ getTotalMinutes(user.workouts) }} min</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<!-- Workout Table Display End -->


<!-- Pagination Options Start -->
<div class="flex gap-5 flex-row md:flex-row justify-center items-center space-y-3 md:space-y-0 md:space-x-2 p-4">

  <button class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50" [disabled]="currentPage === 1" (click)="goToPreviousPage()">Previous</button>

  <div class="flex flex-wrap justify-center items-center space-x-1">
    <button *ngFor="let page of pages" class="px-4 py-2 bg-purple-button-hover text-white rounded-md hover:bg-purple-500 hover:bg-purple-button-hover" [ngClass]="{'text-custom-white bg-purple-button-hover': currentPage === page, 'hover:bg-purple-button': currentPage !== page}" (click)="goToPage(page)">
      {{ page }}
    </button>
  </div>

  <button class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50" [disabled]="currentPage === totalPages" (click)="goToNextPage()">Next</button>

  <div class="flex items-center space-x-2">
    <select id="itemsPerPage" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()" 
      class="px-4 py-2 rounded-lg focus:outline-none bg-primary-light text-white cursor-pointer">
      <option value="5">5</option>
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="50">50</option>
    </select>
    <span class="text-white text-sm">/ page</span>
  </div>
  

</div>
<!-- Pagination Options End -->


<!-- Chart Display Start -->
<div class="hidden md:flex flex-col pb-20 md:flex-row w-full justify-center gap-6 md:gap-10 mt-10 md:mt-20 px-4">

  <div class="flex justify-center md:justify-start">
    <div class="bg-custom-table-header text-white shadow-xl w-64 rounded-lg p-2">
      <ul class="divide-y divide-pink-700">
        <li class="font-custom text-lg text-center pt-3 pb-2"> User Workouts  </li>
        <span *ngFor="let user of userData">
          <li *ngIf="user.name !== selectedUser?.name"
          class="px-4 py-3 font-custom bg-menu-color rounded-lg m-2 hover:bg-purple-button-hover transition duration-300 cursor-pointer border-none"
          (click)="onSelectUser(user.id)">
          {{ user.name }}
        </li> 
        <li *ngIf="user.name === selectedUser?.name"
        class="px-4 py-3 font-custom bg-menu-color-selected rounded-lg m-2 hover:bg-purple-button-hover transition duration-300 cursor-pointer border-r-4 border-purple-400 shadow-lg shadow-purple-300"
        (click)="onSelectUser(user.id)">
        {{ user.name }}
      </li> 
       </span>
      </ul>
    </div>
  </div>
  

  <div class="flex justify-start">
    <div *ngIf="selectedUser" class="w-full  p-4 bg-custom-table-header rounded-xl shadow-lg text-white">
      <h3 class="text-xl font-custom text-center mt-4 mb-6">{{ selectedUser.name }}'s Workout Progress</h3>
  
        <ngx-charts-bar-vertical
          [view]="[650, 350]"
          [scheme]="colorScheme"
          [results]="chartData"
          [gradient]="false"
          [xAxis]="true"
          [yAxis]="true"
          [legend]="true"
          [showXAxisLabel]="true"
          [showYAxisLabel]="true"
          [roundEdges]="true"
          [animations]="true"
          [showGridLines]="true"
          [barPadding]="15"
          style="fill: #fff;">
        </ngx-charts-bar-vertical>
  
    </div>
  </div>

</div>
<!-- Chart Display End -->
